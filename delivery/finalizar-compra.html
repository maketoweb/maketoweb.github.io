<!DOCTYPE html>
<html class="light" lang="es">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Finalizar Pedido - Carnicer√≠a & Market</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#ec1313",
                        "background-light": "#f8f6f6",
                        "background-dark": "#221010",
                    },
                    fontFamily: { "display": ["Work Sans"] },
                },
            },
        }
    </script>
    <style>
        .radio-checked-primary { --radio-dot-svg: url('data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(236,19,19)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3ccircle cx=%278%27 cy=%278%27 r=%273%27/%3e%3c/svg%3e'); }
        input[type="file"]::file-selector-button { display: none; }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark min-h-screen text-[#1b0d0d] dark:text-white pb-40">

<header class="sticky top-0 z-50 bg-background-light/90 dark:bg-background-dark/90 backdrop-blur-md border-b border-[#e7cfcf] dark:border-[#3d2525] px-4 py-4 flex items-center">
    <button onclick="window.history.back()" class="flex items-center gap-2">
        <span class="material-symbols-outlined">arrow_back_ios</span>
        <h2 class="text-lg font-bold">Finalizar Pedido</h2>
    </button>
</header>

<main class="max-w-md mx-auto p-4 space-y-6">
    <section class="space-y-4">
        <h3 class="text-lg font-bold border-l-4 border-primary pl-2">Tus Datos</h3>
        <input type="text" id="nombre" placeholder="Nombre y Apellido" class="w-full h-14 rounded-xl border-[#e7cfcf] dark:border-[#3d2525] bg-white dark:bg-[#2d1a1a] p-4 outline-none focus:ring-1 focus:ring-primary">
        <input type="tel" id="telefono" placeholder="Tel√©fono de contacto" class="w-full h-14 rounded-xl border-[#e7cfcf] dark:border-[#3d2525] bg-white dark:bg-[#2d1a1a] p-4 outline-none focus:ring-1 focus:ring-primary">
    </section>

    <section class="space-y-4">
        <h3 class="text-lg font-bold border-l-4 border-primary pl-2">Ubicaci√≥n en Valencia</h3>
        
        <select id="zona-delivery" onchange="loadOrderData()" class="w-full h-14 rounded-xl border-[#e7cfcf] dark:border-[#3d2525] bg-white dark:bg-[#2d1a1a] px-4 outline-none focus:ring-1 focus:ring-primary">
            <option value="0">Selecciona tu Zona (Precio Delivery)</option>
            <option value="2">San Diego - $2.00</option>
            <option value="3">Naguanagua - $3.00</option>
            <option value="4">Valencia Norte (El Vi√±edo/Prebo) - $4.00</option>
            <option value="5">Valencia Sur (Lomas de Este) - $5.00</option>
            <option value="2.5">Guacara - $2.50</option>
        </select>

        <div class="relative">
            <textarea id="direccion" placeholder="Direcci√≥n exacta y puntos de referencia" class="w-full min-h-[80px] rounded-xl border-[#e7cfcf] dark:border-[#3d2525] bg-white dark:bg-[#2d1a1a] p-4 outline-none focus:ring-1 focus:ring-primary"></textarea>
            <span class="material-symbols-outlined absolute right-4 top-4 text-primary">location_on</span>
        </div>

        <div class="rounded-xl overflow-hidden border border-[#e7cfcf] dark:border-[#3d2525] h-40">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d62817.43735501815!2d-68.012270!3d10.169123!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8e806087d8349257%3A0x6002f5a044e97662!2sValencia%2C%20Carabobo!5e0!3m2!1ses!2sve!4v1710000000000" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
    </section>

    <section class="space-y-4">
        <h3 class="text-lg font-bold border-l-4 border-primary pl-2">Nota para el pedido</h3>
        <input type="text" id="nota" placeholder="Ej: La carne molida sin mucha grasa" class="w-full h-14 rounded-xl border-[#e7cfcf] dark:border-[#3d2525] bg-white dark:bg-[#2d1a1a] p-4 outline-none focus:ring-1 focus:ring-primary">
    </section>

    <section class="radio-checked-primary space-y-3">
        <h3 class="text-lg font-bold border-l-4 border-primary pl-2">M√©todo de Pago</h3>
        
        <label class="flex flex-col gap-3 rounded-xl border border-primary bg-primary/5 p-4 transition-all">
            <div class="flex items-center gap-4">
                <input type="radio" name="payment" value="Pago M√≥vil" checked class="h-5 w-5 text-primary focus:ring-0">
                <div class="grow">
                    <p class="font-bold">Pago M√≥vil (Bancamiga)</p>
                    <p class="text-xs text-gray-500">0412-1234567 | V-12345678</p>
                </div>
            </div>
            
            <div class="bg-white dark:bg-[#1b0d0d] rounded-lg p-3 border border-primary/20 flex items-center justify-between">
                <div class="text-xs space-y-1">
                    <p><b>Banco:</b> Bancamiga (0172)</p>
                    <p><b>Tel:</b> 0412-1234567</p>
                    <p><b>RIF:</b> V-12345678</p>
                </div>
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=PAGOMOVIL_DATA" class="w-16 h-16 rounded border" alt="QR Pago Movil">
            </div>
        </label>

        <label class="flex items-center gap-4 rounded-xl border border-[#e7cfcf] dark:border-[#3d2525] p-4 bg-white dark:bg-[#2d1a1a]">
            <input type="radio" name="payment" value="Efectivo" class="h-5 w-5 text-primary focus:ring-0">
            <p class="font-bold">D√≥lares Efectivo</p>
        </label>
    </section>

    <section>
        <h3 class="text-sm font-bold uppercase text-[#9a4c4c] mb-3">Soporte de Pago (Capture)</h3>
        <label class="border-2 border-dashed border-[#e7cfcf] dark:border-[#3d2525] rounded-xl p-6 flex flex-col items-center justify-center bg-white/50 dark:bg-[#2d1a1a]/50 cursor-pointer">
            <span class="material-symbols-outlined text-3xl text-primary">add_a_photo</span>
            <p class="text-sm font-medium mt-2" id="file-name">Adjuntar captura de pantalla</p>
            <input type="file" id="capture" class="hidden" onchange="document.getElementById('file-name').innerText = this.files[0].name">
        </label>
    </section>

    <div class="p-4 bg-white dark:bg-[#2d1a1a] rounded-2xl shadow-sm space-y-2">
        <div class="flex justify-between text-sm text-gray-500"><span>Subtotal Productos</span><span id="resumen-subtotal">$0.00</span></div>
        <div class="flex justify-between text-sm text-gray-500"><span>Costo Delivery</span><span id="resumen-delivery">$0.00</span></div>
        <div class="flex justify-between text-xl font-bold pt-2 border-t dark:border-white/10">
            <span>Total a Pagar</span><span class="text-primary" id="resumen-total">$0.00</span>
        </div>
    </div>
</main>

<div class="fixed bottom-0 left-0 right-0 bg-white dark:bg-background-dark border-t border-[#e7cfcf] dark:border-[#3d2525] p-4 z-50">
    <div class="max-w-md mx-auto">
        <button onclick="enviarPedido()" class="w-full bg-primary hover:bg-[#c40e0e] text-white py-4 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-lg">
            <span class="material-symbols-outlined">send</span>
            Enviar Pedido a WhatsApp
        </button>
    </div>
</div>

<script>
    function loadOrderData() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const subtotal = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
        
        const deliveryCost = parseFloat(document.getElementById('zona-delivery').value) || 0;
        const totalFinal = subtotal + deliveryCost;

        document.getElementById('resumen-subtotal').innerText = `$${subtotal.toFixed(2)}`;
        document.getElementById('resumen-delivery').innerText = `$${deliveryCost.toFixed(2)}`;
        document.getElementById('resumen-total').innerText = `$${totalFinal.toFixed(2)}`;
        
        return { cart, subtotal, deliveryCost, totalFinal };
    }

    function enviarPedido() {
        const { cart, subtotal, deliveryCost, totalFinal } = loadOrderData();
        
        const nombre = document.getElementById('nombre').value;
        const telefono = document.getElementById('telefono').value;
        const direccion = document.getElementById('direccion').value;
        const nota = document.getElementById('nota').value;
        const zonaSelect = document.getElementById('zona-delivery');
        const zonaNombre = zonaSelect.options[zonaSelect.selectedIndex].text;
        const pago = document.querySelector('input[name="payment"]:checked').value;
        const capture = document.getElementById('capture').files[0];

        if (!nombre || !direccion || !telefono || deliveryCost === 0) {
            alert("Completa todos tus datos y selecciona una zona de delivery.");
            return;
        }

        let productosTxt = "";
        cart.forEach(item => {
            productosTxt += `‚Ä¢ ${item.name} (${item.qty}kg) - $${(item.price * item.qty).toFixed(2)}%0A`;
        });

        const mensaje = 
            `*NUEVA ORDEN - CARNICER√çA*%0A` +
            `--------------------------%0A` +
            `üë§ *Cliente:* ${nombre}%0A` +
            `üìû *Tel√©fono:* ${telefono}%0A` +
            `üìç *Zona:* ${zonaNombre}%0A` +
            `üè† *Direcci√≥n:* ${direccion}%0A` +
            `üìù *Nota:* ${nota || 'Sin notas'}%0A` +
            `üí≥ *M√©todo de Pago:* ${pago}%0A` +
            `--------------------------%0A` +
            `üì¶ *DETALLE DEL PEDIDO:*%0A${productosTxt}%0A` +
            `--------------------------%0A` +
            `üíµ *Subtotal:* $${subtotal.toFixed(2)}%0A` +
            `üõµ *Delivery:* $${deliveryCost.toFixed(2)}%0A` +
            `üí∞ *TOTAL FINAL: $${totalFinal.toFixed(2)}*%0A` +
            `--------------------------%0A` +
            (capture ? `üì∏ *ADJUNTO:* Capture de pago enviado.` : `üì∏ *ADJUNTO:* Pago en efectivo al recibir.`);

        window.open(`https://wa.me/584143420573?text=${mensaje}`, '_blank');
    }

    document.addEventListener('DOMContentLoaded', loadOrderData);
</script>
</body>
</html>
